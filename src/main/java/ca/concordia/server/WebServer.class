// Source code is decompiled from a .class file using FernFlower decompiler.
package ca.concordia.server;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.net.ServerSocket;
import java.net.Socket;
import java.net.URLDecoder;

public class WebServer {
   public WebServer() {
   }

   public void start() throws IOException {
      ServerSocket var1 = new ServerSocket(5000);

      while(true) {
         System.out.println("Waiting for a client to connect...");
         Socket var2 = var1.accept();
         System.out.println("New client...");
         BufferedReader var3 = new BufferedReader(new InputStreamReader(var2.getInputStream()));
         OutputStream var4 = var2.getOutputStream();
         String var5 = var3.readLine();
         if (var5 != null) {
            if (var5.startsWith("GET")) {
               handleGetRequest(var4);
            } else if (var5.startsWith("POST")) {
               handlePostRequest(var3, var4);
            }
         }

         var3.close();
         var4.close();
         var2.close();
      }
   }

   private static void handleGetRequest(OutputStream var0) throws IOException {
      System.out.println("Handling GET request");
      String var1 = "HTTP/1.1 200 OK\r\n\r\n<!DOCTYPE html>\n<html>\n<head>\n<title>Concordia Transfers</title>\n</head>\n<body>\n\n<h1>Welcome to Concordia Transfers</h1>\n<p>Select the account and amount to transfer</p>\n\n<form action=\"/submit\" method=\"post\">\n        <label for=\"account\">Account:</label>\n        <input type=\"text\" id=\"account\" name=\"account\"><br><br>\n\n        <label for=\"value\">Value:</label>\n        <input type=\"text\" id=\"value\" name=\"value\"><br><br>\n\n        <label for=\"toAccount\">To Account:</label>\n        <input type=\"text\" id=\"toAccount\" name=\"toAccount\"><br><br>\n\n        <label for=\"toValue\">To Value:</label>\n        <input type=\"text\" id=\"toValue\" name=\"toValue\"><br><br>\n\n        <input type=\"submit\" value=\"Submit\">\n    </form>\n</body>\n</html>\n";
      var0.write(var1.getBytes());
      var0.flush();
   }

   private static void handlePostRequest(BufferedReader var0, OutputStream var1) throws IOException {
      System.out.println("Handling post request");
      StringBuilder var2 = new StringBuilder();
      int var3 = 0;

      String var4;
      while((var4 = var0.readLine()) != null && !var4.isEmpty()) {
         if (var4.startsWith("Content-Length")) {
            var3 = Integer.parseInt(var4.substring(var4.indexOf(32) + 1));
         }
      }

      for(int var5 = 0; var5 < var3; ++var5) {
         var2.append((char)var0.read());
      }

      System.out.println(var2.toString());
      String[] var19 = var2.toString().split("&");
      String var6 = null;
      String var7 = null;
      String var8 = null;
      String var9 = null;
      String[] var10 = var19;
      int var11 = var19.length;

      for(int var12 = 0; var12 < var11; ++var12) {
         String var13 = var10[var12];
         String[] var14 = var13.split("=");
         if (var14.length == 2) {
            String var15 = URLDecoder.decode(var14[0], "UTF-8");
            String var16 = URLDecoder.decode(var14[1], "UTF-8");
            switch (var15) {
               case "account":
                  var6 = var16;
                  break;
               case "value":
                  var7 = var16;
                  break;
               case "toAccount":
                  var8 = var16;
                  break;
               case "toValue":
                  var9 = var16;
            }
         }
      }

      String var20 = "<html><body><h1>Thank you for using Concordia Transfers</h1><h2>Received Form Inputs:</h2><p>Account: " + var6 + "</p><p>Value: " + var7 + "</p><p>To Account: " + var8 + "</p><p>To Value: " + var9 + "</p></body></html>";
      int var10000 = var20.length();
      String var21 = "HTTP/1.1 200 OK\r\nContent-Length: " + var10000 + "\r\nContent-Type: text/html\r\n\r\n" + var20;
      var1.write(var21.getBytes());
      var1.flush();
   }

   public static void main(String[] var0) {
      WebServer var1 = new WebServer();

      try {
         var1.start();
      } catch (IOException var3) {
         var3.printStackTrace();
      }

   }
}
